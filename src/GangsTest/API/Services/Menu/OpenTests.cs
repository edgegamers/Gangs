using GangsAPI.Services.Menu;

namespace GangsTest.API.Services.Menu;

public class OpenTests(IMenuManager menus) : TestParent(menus) {
  [Theory]
  [ClassData(typeof(TestData))]
  public async Task Opens(IMenuManager mgr) {
    Assert.Null(mgr.GetActiveMenu(TestPlayer));
    Assert.True(await mgr.OpenMenu(TestPlayer, TestMenu));
    var active = mgr.GetActiveMenu(TestPlayer);
    Assert.NotNull(active);
    Assert.Equal(TestMenu, active);
  }

  [Theory]
  [ClassData(typeof(TestData))]
  public async Task Opens_Multiple(IMenuManager mgr) {
    var other = new TestMenuClass(mgr, "Foobar Title");
    Assert.Null(mgr.GetActiveMenu(TestPlayer));
    Assert.True(await mgr.OpenMenu(TestPlayer, TestMenu));
    var active = mgr.GetActiveMenu(TestPlayer);
    Assert.NotNull(active);
    Assert.Equal(TestMenu, active);
    Assert.True(await mgr.OpenMenu(TestPlayer, other));
    active = mgr.GetActiveMenu(TestPlayer);
    Assert.NotNull(active);
    Assert.Equal(other, active);
  }

  [Theory]
  [ClassData(typeof(TestData))]
  public async Task Opens_Prints(IMenuManager mgr) {
    Assert.Null(mgr.GetActiveMenu(TestPlayer));
    Assert.True(await mgr.OpenMenu(TestPlayer, TestMenu));
    Assert.Contains("Test Menu Title", TestPlayer.ChatOutput);
    Assert.Contains("1 | Test Menu Option", TestPlayer.ChatOutput);
  }
}